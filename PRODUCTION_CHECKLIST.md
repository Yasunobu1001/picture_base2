# 本番環境デプロイメント チェックリスト

このチェックリストは写真共有サイトを本番環境にデプロイする際の確認事項です。
各項目を順番に確認し、チェックマークを付けてください。

## 事前準備

### システム要件
- [ ] Ubuntu 20.04 LTS または CentOS 8 以上
- [ ] Python 3.8 以上がインストール済み
- [ ] PostgreSQL 12 以上がインストール済み
- [ ] Redis 6 以上がインストール済み
- [ ] Nginx 1.18 以上がインストール済み
- [ ] 最低 2GB RAM、20GB ディスク容量を確保
- [ ] ドメイン名の DNS 設定完了

### セキュリティ準備
- [ ] SSL証明書の準備（Let's Encrypt推奨）
- [ ] 強力なパスワードの生成（データベース、管理者等）
- [ ] SSH鍵認証の設定
- [ ] ファイアウォール設定の計画

## 1. システム設定

### ユーザー・ディレクトリ設定
- [ ] www-data ユーザーの作成
- [ ] /var/www/photo_sharing ディレクトリの作成
- [ ] /var/log/django, /var/log/gunicorn ディレクトリの作成
- [ ] /run/gunicorn ディレクトリの作成
- [ ] 適切なファイル権限の設定

### データベース設定
- [ ] PostgreSQL サービスの開始・有効化
- [ ] photo_sharing_db データベースの作成
- [ ] photo_sharing_user ユーザーの作成
- [ ] データベース権限の設定
- [ ] データベース接続テスト

### Redis設定
- [ ] Redis サービスの開始・有効化
- [ ] Redis 接続テスト（redis-cli ping）
- [ ] Redis メモリ設定の最適化

## 2. アプリケーション設定

### コードデプロイ
- [ ] アプリケーションコードの配置
- [ ] Python 仮想環境の作成
- [ ] 依存関係のインストール（pip install -r requirements.txt）
- [ ] .env.production ファイルの作成・設定

### 環境変数設定
- [ ] SECRET_KEY の設定（強力なランダム文字列）
- [ ] DEBUG=False の設定
- [ ] ALLOWED_HOSTS の設定（実際のドメイン名）
- [ ] データベース接続情報の設定
- [ ] Redis URL の設定
- [ ] メール設定（SMTP）
- [ ] 管理者メールアドレスの設定

### Django設定
- [ ] データベースマイグレーションの実行
- [ ] 静的ファイルの収集（collectstatic）
- [ ] CSS ビルド（npm run build-css-prod）
- [ ] スーパーユーザーの作成
- [ ] Django 設定テスト（python manage.py check）

## 3. Webサーバー設定

### Nginx設定
- [ ] nginx.conf.template を /etc/nginx/sites-available/ にコピー
- [ ] 設定ファイル内のドメイン名を実際の値に変更
- [ ] サイトの有効化（sites-enabled へのシンボリックリンク）
- [ ] デフォルトサイトの無効化
- [ ] Nginx 設定テスト（nginx -t）
- [ ] Nginx サービスの再起動・有効化

### SSL証明書設定
- [ ] Certbot のインストール
- [ ] SSL証明書の取得（certbot --nginx）
- [ ] 証明書の自動更新設定（crontab）
- [ ] HTTPS リダイレクトの確認

## 4. アプリケーションサーバー設定

### Gunicorn設定
- [ ] gunicorn.conf.py の配置・設定確認
- [ ] photo-sharing.service の配置
- [ ] photo-sharing.socket の配置
- [ ] systemd デーモンリロード
- [ ] サービスの有効化・開始
- [ ] サービス状態の確認

## 5. セキュリティ設定

### ファイアウォール
- [ ] SSH ポート（22）の許可
- [ ] HTTP ポート（80）の許可
- [ ] HTTPS ポート（443）の許可
- [ ] 不要なポートの遮断
- [ ] ファイアウォールの有効化

### ファイル権限
- [ ] アプリケーションファイルの所有者設定（www-data）
- [ ] 実行可能ファイルの権限設定（755）
- [ ] 設定ファイルの権限設定（644）
- [ ] メディアディレクトリの権限設定
- [ ] ログディレクトリの権限設定

### セキュリティヘッダー
- [ ] HSTS ヘッダーの設定
- [ ] X-Content-Type-Options の設定
- [ ] X-Frame-Options の設定
- [ ] Content Security Policy の設定
- [ ] セキュリティヘッダーのテスト

## 6. 監視・ログ設定

### ログ設定
- [ ] Django ログ設定の確認
- [ ] Gunicorn ログ設定の確認
- [ ] Nginx ログ設定の確認
- [ ] ログローテーション設定（logrotate）
- [ ] ログファイルの権限確認

### 監視設定
- [ ] ヘルスチェックエンドポイントのテスト
- [ ] システム監視スクリプトの設置
- [ ] 監視スクリプトの cron 設定
- [ ] アラート設定（オプション）

## 7. バックアップ設定

### データベースバックアップ
- [ ] バックアップスクリプトの作成
- [ ] バックアップディレクトリの作成
- [ ] バックアップスクリプトの実行権限設定
- [ ] 日次バックアップの cron 設定
- [ ] バックアップテストの実行

### ファイルバックアップ
- [ ] メディアファイルバックアップの設定
- [ ] 設定ファイルバックアップの設定
- [ ] バックアップ保持期間の設定
- [ ] バックアップ復旧テスト

## 8. パフォーマンス最適化

### データベース最適化
- [ ] PostgreSQL 設定の最適化
- [ ] インデックスの確認
- [ ] クエリパフォーマンスの確認
- [ ] 接続プールの設定

### キャッシュ設定
- [ ] Redis キャッシュの設定確認
- [ ] セッションストレージの Redis 設定
- [ ] キャッシュ動作テスト

### 静的ファイル最適化
- [ ] Gzip 圧縮の有効化
- [ ] 静的ファイルの Expires ヘッダー設定
- [ ] CSS/JS の最小化確認

## 9. 機能テスト

### 基本機能テスト
- [ ] ホームページの表示確認
- [ ] ユーザー登録機能のテスト
- [ ] ログイン・ログアウト機能のテスト
- [ ] 写真アップロード機能のテスト
- [ ] 写真表示機能のテスト
- [ ] 写真編集・削除機能のテスト

### セキュリティテスト
- [ ] HTTPS 接続の確認
- [ ] HTTP から HTTPS へのリダイレクト確認
- [ ] 管理画面へのアクセステスト
- [ ] 不正アクセス防止の確認
- [ ] ファイルアップロードセキュリティの確認

### パフォーマンステスト
- [ ] ページ読み込み速度の確認
- [ ] 大きなファイルアップロードのテスト
- [ ] 同時アクセス負荷テスト（オプション）
- [ ] メモリ・CPU 使用量の確認

## 10. 運用準備

### ドキュメント準備
- [ ] 運用マニュアルの作成
- [ ] トラブルシューティングガイドの準備
- [ ] 緊急連絡先リストの作成
- [ ] バックアップ・復旧手順の文書化

### 監視・アラート
- [ ] システムリソース監視の設定
- [ ] アプリケーション監視の設定
- [ ] エラーアラートの設定
- [ ] 稼働率監視の設定

### メンテナンス計画
- [ ] 定期メンテナンススケジュールの策定
- [ ] アップデート手順の確立
- [ ] 障害対応手順の確立
- [ ] データ保持ポリシーの策定

## 11. 最終確認

### 全体テスト
- [ ] 全機能の動作確認
- [ ] 異なるブラウザでの動作確認
- [ ] モバイルデバイスでの動作確認
- [ ] 負荷テストの実行（推奨）

### セキュリティ最終確認
- [ ] セキュリティスキャンの実行
- [ ] 脆弱性チェックの実行
- [ ] ペネトレーションテスト（推奨）
- [ ] セキュリティ設定の最終確認

### 運用開始準備
- [ ] DNS 設定の最終確認
- [ ] SSL証明書の有効性確認
- [ ] 監視システムの動作確認
- [ ] バックアップシステムの動作確認
- [ ] 緊急時対応手順の確認

## 12. 運用開始後

### 初期監視
- [ ] 24時間の安定稼働確認
- [ ] エラーログの確認
- [ ] パフォーマンス指標の確認
- [ ] ユーザーフィードバックの収集

### 継続的改善
- [ ] 週次レポートの作成
- [ ] 月次セキュリティ更新の適用
- [ ] 四半期バックアップテストの実施
- [ ] 年次セキュリティ監査の実施

---

## 完了確認

すべての項目にチェックが付いたら、本番環境への移行準備が完了です。

**デプロイ実行者:** _______________  
**確認者:** _______________  
**デプロイ日時:** _______________  
**備考:** _______________